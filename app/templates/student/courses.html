<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>学生课程列表</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='bootstrap-4.1.3-dist/css/bootstrap.min.css') }}">

    <style>
        .course-container {
            margin-top: 40px;
        }
        .right-top-btn {
            position: absolute;
            top: 15px;
            right: 20px;
        }
    </style>
</head>

<body class="app header-fixed sidebar-fixed aside-menu-fixed sidebar-lg-show">

<header class="app-header navbar">
    <span class="badge badge-light">软件工程实践 Lab</span>

    <!-- 右上角 按钮 -->
    <div class="col-sm-6 text-right">
        <a href="{{ url_for('student_emoji_history') }}" class="btn btn-outline-info btn-sm right-top-btn">
            表情历史
        </a>
    </div>
    <div class="col-sm-6 text-right">
        <a href="{{ url_for('welcome_student') }}" class="btn btn-secondary">
            返回学生主界面
        </a>
    </div>
</header>

<div class="app-body">
    <main class="main">
        <div class="container">
            <div class="animated fadeIn">

                <h2 class="mt-4">我的课程</h2>

                <!-- Flash 消息 -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        <br>
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <div class="course-container">
                    <table class="table table-bordered table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th>课程编号</th>
                                <th>课程名称</th>
                                <th>发送表情</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for course in courses %}
                            <tr>
                                <td>{{ course.id }}</td>
                                <td>{{ course.name }}</td>
                                <td>
                                    <!-- 这里实现的效果是 -->
                                    <!-- 初始显示 Emoji 1 图 -->
                                    <!-- 用户从下拉选择 type → 右侧图自动变成type.png -->
                                    <!-- 不知道实现上有没有问题 -->
                                    <form action="{{ url_for('send_emoji', course_id=course.id) }}" method="POST">
                                            
                                        <div style="display:flex; align-items:center;">
                                            <!-- 选择框 -->
                                            <select name="emoji_type" id="emoji_select_{{ course.id }}"
                                                    class="form-control"
                                                    style="width:180px; display:inline-block;"
                                                    onchange="updatePreview('{{ course.id }}')">
                                                {% for key, value in EMOJI_TYPE_MAP.items() %}
                                                    <option value="{{ key }}">{{ value }}</option>
                                                {% endfor %}
                                            </select>

                                            <!-- 预览图 -->
                                            <img id="emoji_preview_{{ course.id }}"
                                                src="{{ url_for('static', filename='emoji/1.png') }}"
                                                width="32" height="32"
                                                style="margin-left:10px;">
                                                <button type="submit" class="btn btn-primary btn-sm" style="margin-left:30px;">发送</button>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                </div>

            </div>
        </div>
    </main>
</div>

</body>

<!-- 放在 body 底部的 JS，不阻塞渲染 -->
<script>
function updatePreview(course_id) {
    const select = document.getElementById('emoji_select_' + course_id);
    const preview = document.getElementById('emoji_preview_' + course_id);
    preview.src = "/static/emoji/" + select.value + ".png";
}
</script>

</html>
